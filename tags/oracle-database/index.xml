<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>oracle-database on 第二大腦</title><link>https://2ndbrain.cc/tags/oracle-database/</link><description>Recent content in oracle-database on 第二大腦</description><generator>Hugo -- gohugo.io</generator><language>zh-TW</language><lastBuildDate>Wed, 21 Jul 2021 08:57:42 +0800</lastBuildDate><atom:link href="https://2ndbrain.cc/tags/oracle-database/index.xml" rel="self" type="application/rss+xml"/><item><title>解決 ORA-02292 問題</title><link>https://2ndbrain.cc/posts/2021/07/resolve-ora-02292/</link><pubDate>Wed, 21 Jul 2021 08:57:42 +0800</pubDate><guid>https://2ndbrain.cc/posts/2021/07/resolve-ora-02292/</guid><description>&lt;p>在刪除資料表中的資料，有時會發生 &lt;code>ORA-02292 違反完整性限制條件 (%s.%s) - 發現子項記錄&lt;/code> 錯誤，
導致無法將資料刪除，因為想刪除的資料是其他資料表的 Foreign Key。&lt;/p>
&lt;blockquote>
&lt;p>錯誤代碼: ORA-02292&lt;br>
描述: 違反完整性限制條件 (%s.%s) - 發現子項記錄&lt;br>
原因: 嘗試刪除具有外鍵依賴性的父鍵值。&lt;br>
動作: 首先刪除依賴項，然後刪除父項或禁用約束。&lt;/p>
&lt;/blockquote>
&lt;h1 id="正規刪除">正規刪除&lt;/h1>
&lt;p>當兩張資料表存在著父子階層關係，而父階層的資料是子階層的資料對照，
所以資料庫不允許先將父階層資料刪除。此時想刪除父階層資料，必須先刪除子階層資料。&lt;/p>
&lt;h1 id="取巧刪除">取巧刪除&lt;/h1>
&lt;p>搞不清楚自己在做什麼的話，不要亂用這招。&lt;/p>
&lt;p>若因為某些原因就是想直接刪除父階層資料，而不動到子階層資料時，可以使用禁用約束的方式，
先 disable constraint，刪除想刪的資料後，再 enable constraint，範例如下：&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sql" data-lang="sql">&lt;span style="color:#859900">alter&lt;/span> &lt;span style="color:#859900">table&lt;/span> {&lt;span style="color:#859900">TABLE_NAME&lt;/span>} &lt;span style="color:#268bd2">disable&lt;/span> &lt;span style="color:#859900">constraint&lt;/span> {&lt;span style="color:#268bd2">FOREIGN_KEY_NAME&lt;/span>} &lt;span style="color:#859900">cascade&lt;/span>;
&lt;span style="color:#93a1a1;font-style:italic">-- 執行刪除資料
&lt;/span>&lt;span style="color:#93a1a1;font-style:italic">&lt;/span>&lt;span style="color:#859900">alter&lt;/span> &lt;span style="color:#859900">table&lt;/span> {&lt;span style="color:#859900">TABLE_NAME&lt;/span>} &lt;span style="color:#268bd2">enable&lt;/span> &lt;span style="color:#268bd2">novalidate&lt;/span> &lt;span style="color:#859900">constraint&lt;/span> {&lt;span style="color:#268bd2">FOREIGN_KEY_NAME&lt;/span>};
&lt;/code>&lt;/pre>&lt;/div>&lt;p>值得特別注意的是，在 enable constraint 時，若沒有加上 &lt;code>novalidate&lt;/code>，
可能會發生 &lt;code>ORA-02298: 無法驗證 (%s.%s) - 未找到父項關鍵字&lt;/code> 錯誤，
因為 Oracle 在 enable constraint 時，會檢核原有資料是否符合約束，
加上 &lt;code>novalidate&lt;/code> 就可以再度繞過資料庫的檢核。&lt;/p>
&lt;p>搞不清楚自己在做什麼的話，不要亂用這招。&lt;/p></description></item></channel></rss>